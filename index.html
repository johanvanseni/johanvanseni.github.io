<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Chibi Free Fire Ultimate - Touchscreen</title>
<style>
body {
    margin:0;
    background: url('https://i.ibb.co/yX5Q0kb/cute-wallpaper.jpg') no-repeat center center fixed;
    background-size: cover;
    font-family:sans-serif;
    user-select:none;
}
#gameContainer {
    position: relative;
    margin: auto;
    max-width:400px;
}
#gameCanvas {
    background: rgba(255,255,255,0.15);
    border:2px solid #fff;
    border-radius:15px;
    display:none;
    width:100%;
}
#scoreBoard, #leaderboard {
    position:absolute;
    color:#fff;
    text-shadow:1px 1px 4px #000;
    display:none;
}
#scoreBoard { top:10px; left:50%; transform:translateX(-50%); font-size:20px; }
#leaderboard { top:10px; right:10px; font-size:14px; text-align:left; }

#characterSelect { text-align:center; }
.character-btn {
    display:inline-block;
    width:60px; height:60px; margin:10px; border-radius:10px;
    cursor:pointer; border:2px solid #fff;
    font-size:30px; line-height:60px; user-select:none;
}

#touchControls {
    display:none;
    position: absolute;
    bottom: 10px; width: 100%;
    text-align:center;
}
.touch-btn {
    width:60px; height:60px; margin:5px;
    display:inline-block;
    font-size:30px; border-radius:10px;
    background:rgba(255,255,255,0.3);
    border:2px solid #fff; user-select:none;
}
</style>
</head>
<body>

<div id="characterSelect">
    <h2>Pilih Karakter Chibi!</h2>
    <div class="character-btn" style="background:pink;">üíñ</div>
    <div class="character-btn" style="background:cyan;">üíô</div>
    <div class="character-btn" style="background:lime;">üíö</div>
    <div class="character-btn" style="background:yellow;">üíõ</div>
</div>

<div id="gameContainer">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div id="scoreBoard">Score: <span id="score">0</span></div>
    <div id="leaderboard">Leaderboard:</div>
    <div id="touchControls">
        <div>
            <div class="touch-btn" id="up">‚ñ≤</div>
        </div>
        <div>
            <div class="touch-btn" id="left">‚óÑ</div>
            <div class="touch-btn" id="shoot">üî•</div>
            <div class="touch-btn" id="right">‚ñ∫</div>
        </div>
        <div>
            <div class="touch-btn" id="down">‚ñº</div>
        </div>
    </div>
</div>

<audio id="bgMusic" src="https://assets.mixkit.co/music/preview/mixkit-cute-upbeat-game-132.mp3" loop></audio>
<audio id="shootSound" src="https://freesound.org/data/previews/341/341695_6265152-lq.mp3"></audio>
<audio id="explosionSound" src="https://freesound.org/data/previews/466/466553_7037-lq.mp3"></audio>
<audio id="powerupSound" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const leaderboardEl = document.getElementById('leaderboard');
const charSelect = document.getElementById('characterSelect');
const touchControls = document.getElementById('touchControls');

const bgMusic = document.getElementById('bgMusic');
const shootSound = document.getElementById('shootSound');
const explosionSound = document.getElementById('explosionSound');
const powerupSound = document.getElementById('powerupSound');

let playerName = prompt("Masukkan nama pemain:", "Player");
let score = 0;
let bullets = [], enemies = [], powerUps = [], explosions = [], particles = [];
let keys = {up:false,down:false,left:false,right:false,space:false};
let level = 1;
let speedBoost = false;

let player = {x:180, y:500, size:30, color:'pink', bob:0};

// Pilih karakter
document.querySelectorAll('.character-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
        player.color = btn.style.background;
        charSelect.style.display='none';
        canvas.style.display='block';
        scoreEl.parentElement.style.display='block';
        leaderboardEl.style.display='block';
        touchControls.style.display='block';
        bgMusic.volume=0.3; bgMusic.play();
        gameLoop();
        updateLeaderboardDisplay();
    });
});

// Spawn enemy
function spawnEnemy(){ enemies.push({x:Math.random()*370,y:-30,size:30,color:'purple',speed:2+level*0.2,bob:Math.random()*Math.PI*2}); }
function spawnPowerUp(){ const types=['heart','star','candy','speed']; powerUps.push({x:Math.random()*370,y:-30,size:20,type:types[Math.floor(Math.random()*types.length)],speed:1.5,bob:Math.random()*Math.PI*2}); }

// Leaderboard
function saveScore(name, score){
    let scores = JSON.parse(localStorage.getItem('superChibiFFUltimateTouch')||'[]');
    scores.push({name, score}); scores.sort((a,b)=>b.score-a.score);
    if(scores.length>5) scores=scores.slice(0,5);
    localStorage.setItem('superChibiFFUltimateTouch', JSON.stringify(scores));
}
function updateLeaderboardDisplay(){
    let scores = JSON.parse(localStorage.getItem('superChibiFFUltimateTouch')||'[]');
    let html = 'Leaderboard:<br>';
    scores.forEach((s,i)=>{html += `${i+1}. ${s.name}: ${s.score}<br>`});
    leaderboardEl.innerHTML = html;
}

// Particle efek
function spawnParticles(x,y,color){ for(let i=0;i<10;i++){ particles.push({x:x,y:y,dx:(Math.random()-0.5)*4,dy:(Math.random()-0.5)*4,radius:2+Math.random()*3,color:color,alpha:1}); }}

// Game loop
function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    let pspeed = speedBoost ? 6 : 4;
    if(keys.up && player.y>0) player.y -= pspeed;
    if(keys.down && player.y<canvas.height-player.size) player.y += pspeed;
    if(keys.left && player.x>0) player.x -= pspeed;
    if(keys.right && player.x<canvas.width-player.size) player.x += pspeed;

    player.bob += 0.1; let bobOffset = Math.sin(player.bob)*5;

    if(keys.space && bullets.length<5){ bullets.push({x:player.x+player.size/2-5, y:player.y, size:10, speed:6}); shootSound.currentTime=0; shootSound.play(); }

    ctx.fillStyle = player.color; ctx.fillRect(player.x,player.y+bobOffset,player.size,player.size);
    ctx.fillStyle='black'; ctx.fillRect(player.x+5,player.y+5+bobOffset,5,5); ctx.fillRect(player.x+player.size-10,player.y+5+bobOffset,5,5);

    bullets.forEach((b,i)=>{ b.y -= b.speed; ctx.fillStyle='yellow'; ctx.fillRect(b.x,b.y,b.size,b.size); if(b.y<0) bullets.splice(i,1); });

    if(Math.random()<0.03) spawnEnemy();
    if(Math.random()<0.02) spawnPowerUp();

    enemies.forEach((e,ei)=>{
        e.y += e.speed; let bob = Math.sin(e.bob)*3; e.bob+=0.05;
        ctx.fillStyle=e.color; ctx.fillRect(e.x,e.y+bob,e.size,e.size);
        ctx.fillStyle='white'; ctx.fillRect(e.x+5,e.y+5+bob,5,5); ctx.fillRect(e.x+e.size-10,e.y+5+bob,5,5);

        if(e.x < player.x+player.size && e.x+e.size>player.x && e.y+bob < player.y+player.size && e.y+e.size+bob>player.y){
            alert('Game Over! Score: '+score); saveScore(playerName, score); updateLeaderboardDisplay(); location.reload();
        }

        bullets.forEach((b,bi)=>{ if(b.x < e.x+e.size && b.x+b.size>e.x && b.y < e.y+e.size && b.y+b.size>e.y){
            bullets.splice(bi,1); enemies.splice(ei,1); score+=10; scoreEl.innerText=score;
            explosions.push({x:e.x+e.size/2, y:e.y+e.size/2, radius:5, alpha:1});
            spawnParticles(e.x+e.size/2,e.y+e.size/2,'orange'); explosionSound.currentTime=0; explosionSound.play();
            if(score%50===0) level++;
        }});
        if(e.y>canvas.height) enemies.splice(ei,1);
    });

    powerUps.forEach((p,pi)=>{
        p.y += p.speed; let bob = Math.sin(p.bob)*2; p.bob+=0.05;
        ctx.font='20px Arial'; let emoji='üíñ'; if(p.type=='star') emoji='‚≠ê'; if(p.type=='candy') emoji='üç¨'; if(p.type=='speed') emoji='‚ö°';
        ctx.fillText(emoji,p.x,p.y+20+bob);
        if(p.x < player.x+player.size && p.x+p.size>player.x && p.y+bob < player.y+player.size && p.y+p.size+bob>player.y){
            if(p.type=='speed'){ speedBoost=true; setTimeout(()=>speedBoost=false,5000);}
            score += (p.type=='speed')?15:5; powerUps.splice(pi,1); scoreEl.innerText=score;
            powerupSound.currentTime=0; powerupSound.play(); spawnParticles(p.x+10,p.y+10,'cyan');
        }
        if(p.y>canvas.height) powerUps.splice(pi,1);
    });

    explosions.forEach((ex,ei)=>{ ctx.beginPath(); ctx.arc(ex.x,ex.y,ex.radius,0,Math.PI*2); ctx.fillStyle=`rgba(255,255,0,${ex.alpha})`; ctx.fill(); ex.radius+=1; ex.alpha-=0.05; if(ex.alpha<=0) explosions.splice(ei,1); });

    particles.forEach((p,pi)=>{ ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fillStyle=`rgba(255,255,255,${p.alpha})`; ctx.fill(); p.x+=p.dx;p.y+=p.dy; p.alpha-=0.03; if(p.alpha<=0) particles.splice(pi,1); });

    requestAnimationFrame(gameLoop);
}

// Touch controls
['up','down','left','right','shoot'].forEach(id=>{
    const btn = document.getElementById(id);
    btn.addEventListener('touchstart',()=>{ keys[id=='shoot'?'space':id]=true; });
    btn.addEventListener('touchend',()=>{ keys[id=='shoot'?'space':id]=false; });
});
</script>
</body>
</html>
